server.log(imp.getsoftwareversion());
imp.enableblinkup(true);
imp.configure("NeoPixel",[],[]);

const bits = "\xC0\x30\x0C\x03\x00\xC0\x30\x0C\x03\x00\xC0\x30\x0C\x03\x00\xC0\x30\x0C\x03\xE0\xC0\x30\x0C\x03\x00\xC0\x30\x0F\x83\x00\xC0\x30\x0C\x03\x00\xC0\x30\x0F\x83\xE0\xC0\x30\x0C\x03\x00\xC0\x3E\x0C\x03\x00\xC0\x30\x0C\x03\x00\xC0\x3E\x0C\x03\xE0\xC0\x30\x0C\x03\x00\xC0\x3E\x0F\x83\x00\xC0\x30\x0C\x03\x00\xC0\x3E\x0F\x83\xE0\xC0\x30\x0C\x03\x00\xF8\x30\x0C\x03\x00\xC0\x30\x0C\x03\x00\xF8\x30\x0C\x03\xE0\xC0\x30\x0C\x03\x00\xF8\x30\x0F\x83\x00\xC0\x30\x0C\x03\x00\xF8\x30\x0F\x83\xE0\xC0\x30\x0C\x03\x00\xF8\x3E\x0C\x03\x00\xC0\x30\x0C\x03\x00\xF8\x3E\x0C\x03\xE0\xC0\x30\x0C\x03\x00\xF8\x3E\x0F\x83\x00\xC0\x30\x0C\x03\x00\xF8\x3E\x0F\x83\xE0\xC0\x30\x0C\x03\xE0\xC0\x30\x0C\x03\x00\xC0\x30\x0C\x03\xE0\xC0\x30\x0C\x03\xE0\xC0\x30\x0C\x03\xE0\xC0\x30\x0F\x83\x00\xC0\x30\x0C\x03\xE0\xC0\x30\x0F\x83\xE0\xC0\x30\x0C\x03\xE0\xC0\x3E\x0C\x03\x00\xC0\x30\x0C\x03\xE0\xC0\x3E\x0C\x03\xE0\xC0\x30\x0C\x03\xE0\xC0\x3E\x0F\x83\x00\xC0\x30\x0C\x03\xE0\xC0\x3E\x0F\x83\xE0\xC0\x30\x0C\x03\xE0\xF8\x30\x0C\x03\x00\xC0\x30\x0C\x03\xE0\xF8\x30\x0C\x03\xE0\xC0\x30\x0C\x03\xE0\xF8\x30\x0F\x83\x00\xC0\x30\x0C\x03\xE0\xF8\x30\x0F\x83\xE0\xC0\x30\x0C\x03\xE0\xF8\x3E\x0C\x03\x00\xC0\x30\x0C\x03\xE0\xF8\x3E\x0C\x03\xE0\xC0\x30\x0C\x03\xE0\xF8\x3E\x0F\x83\x00\xC0\x30\x0C\x03\xE0\xF8\x3E\x0F\x83\xE0\xC0\x30\x0F\x83\x00\xC0\x30\x0C\x03\x00\xC0\x30\x0F\x83\x00\xC0\x30\x0C\x03\xE0\xC0\x30\x0F\x83\x00\xC0\x30\x0F\x83\x00\xC0\x30\x0F\x83\x00\xC0\x30\x0F\x83\xE0\xC0\x30\x0F\x83\x00\xC0\x3E\x0C\x03\x00\xC0\x30\x0F\x83\x00\xC0\x3E\x0C\x03\xE0\xC0\x30\x0F\x83\x00\xC0\x3E\x0F\x83\x00\xC0\x30\x0F\x83\x00\xC0\x3E\x0F\x83\xE0\xC0\x30\x0F\x83\x00\xF8\x30\x0C\x03\x00\xC0\x30\x0F\x83\x00\xF8\x30\x0C\x03\xE0\xC0\x30\x0F\x83\x00\xF8\x30\x0F\x83\x00\xC0\x30\x0F\x83\x00\xF8\x30\x0F\x83\xE0\xC0\x30\x0F\x83\x00\xF8\x3E\x0C\x03\x00\xC0\x30\x0F\x83\x00\xF8\x3E\x0C\x03\xE0\xC0\x30\x0F\x83\x00\xF8\x3E\x0F\x83\x00\xC0\x30\x0F\x83\x00\xF8\x3E\x0F\x83\xE0\xC0\x30\x0F\x83\xE0\xC0\x30\x0C\x03\x00\xC0\x30\x0F\x83\xE0\xC0\x30\x0C\x03\xE0\xC0\x30\x0F\x83\xE0\xC0\x30\x0F\x83\x00\xC0\x30\x0F\x83\xE0\xC0\x30\x0F\x83\xE0\xC0\x30\x0F\x83\xE0\xC0\x3E\x0C\x03\x00\xC0\x30\x0F\x83\xE0\xC0\x3E\x0C\x03\xE0\xC0\x30\x0F\x83\xE0\xC0\x3E\x0F\x83\x00\xC0\x30\x0F\x83\xE0\xC0\x3E\x0F\x83\xE0\xC0\x30\x0F\x83\xE0\xF8\x30\x0C\x03\x00\xC0\x30\x0F\x83\xE0\xF8\x30\x0C\x03\xE0\xC0\x30\x0F\x83\xE0\xF8\x30\x0F\x83\x00\xC0\x30\x0F\x83\xE0\xF8\x30\x0F\x83\xE0\xC0\x30\x0F\x83\xE0\xF8\x3E\x0C\x03\x00\xC0\x30\x0F\x83\xE0\xF8\x3E\x0C\x03\xE0\xC0\x30\x0F\x83\xE0\xF8\x3E\x0F\x83\x00\xC0\x30\x0F\x83\xE0\xF8\x3E\x0F\x83\xE0\xC0\x3E\x0C\x03\x00\xC0\x30\x0C\x03\x00\xC0\x3E\x0C\x03\x00\xC0\x30\x0C\x03\xE0\xC0\x3E\x0C\x03\x00\xC0\x30\x0F\x83\x00\xC0\x3E\x0C\x03\x00\xC0\x30\x0F\x83\xE0\xC0\x3E\x0C\x03\x00\xC0\x3E\x0C\x03\x00\xC0\x3E\x0C\x03\x00\xC0\x3E\x0C\x03\xE0\xC0\x3E\x0C\x03\x00\xC0\x3E\x0F\x83\x00\xC0\x3E\x0C\x03\x00\xC0\x3E\x0F\x83\xE0\xC0\x3E\x0C\x03\x00\xF8\x30\x0C\x03\x00\xC0\x3E\x0C\x03\x00\xF8\x30\x0C\x03\xE0\xC0\x3E\x0C\x03\x00\xF8\x30\x0F\x83\x00\xC0\x3E\x0C\x03\x00\xF8\x30\x0F\x83\xE0\xC0\x3E\x0C\x03\x00\xF8\x3E\x0C\x03\x00\xC0\x3E\x0C\x03\x00\xF8\x3E\x0C\x03\xE0\xC0\x3E\x0C\x03\x00\xF8\x3E\x0F\x83\x00\xC0\x3E\x0C\x03\x00\xF8\x3E\x0F\x83\xE0\xC0\x3E\x0C\x03\xE0\xC0\x30\x0C\x03\x00\xC0\x3E\x0C\x03\xE0\xC0\x30\x0C\x03\xE0\xC0\x3E\x0C\x03\xE0\xC0\x30\x0F\x83\x00\xC0\x3E\x0C\x03\xE0\xC0\x30\x0F\x83\xE0\xC0\x3E\x0C\x03\xE0\xC0\x3E\x0C\x03\x00\xC0\x3E\x0C\x03\xE0\xC0\x3E\x0C\x03\xE0\xC0\x3E\x0C\x03\xE0\xC0\x3E\x0F\x83\x00\xC0\x3E\x0C\x03\xE0\xC0\x3E\x0F\x83\xE0\xC0\x3E\x0C\x03\xE0\xF8\x30\x0C\x03\x00\xC0\x3E\x0C\x03\xE0\xF8\x30\x0C\x03\xE0\xC0\x3E\x0C\x03\xE0\xF8\x30\x0F\x83\x00\xC0\x3E\x0C\x03\xE0\xF8\x30\x0F\x83\xE0\xC0\x3E\x0C\x03\xE0\xF8\x3E\x0C\x03\x00\xC0\x3E\x0C\x03\xE0\xF8\x3E\x0C\x03\xE0\xC0\x3E\x0C\x03\xE0\xF8\x3E\x0F\x83\x00\xC0\x3E\x0C\x03\xE0\xF8\x3E\x0F\x83\xE0\xC0\x3E\x0F\x83\x00\xC0\x30\x0C\x03\x00\xC0\x3E\x0F\x83\x00\xC0\x30\x0C\x03\xE0\xC0\x3E\x0F\x83\x00\xC0\x30\x0F\x83\x00\xC0\x3E\x0F\x83\x00\xC0\x30\x0F\x83\xE0\xC0\x3E\x0F\x83\x00\xC0\x3E\x0C\x03\x00\xC0\x3E\x0F\x83\x00\xC0\x3E\x0C\x03\xE0\xC0\x3E\x0F\x83\x00\xC0\x3E\x0F\x83\x00\xC0\x3E\x0F\x83\x00\xC0\x3E\x0F\x83\xE0\xC0\x3E\x0F\x83\x00\xF8\x30\x0C\x03\x00\xC0\x3E\x0F\x83\x00\xF8\x30\x0C\x03\xE0\xC0\x3E\x0F\x83\x00\xF8\x30\x0F\x83\x00\xC0\x3E\x0F\x83\x00\xF8\x30\x0F\x83\xE0\xC0\x3E\x0F\x83\x00\xF8\x3E\x0C\x03\x00\xC0\x3E\x0F\x83\x00\xF8\x3E\x0C\x03\xE0\xC0\x3E\x0F\x83\x00\xF8\x3E\x0F\x83\x00\xC0\x3E\x0F\x83\x00\xF8\x3E\x0F\x83\xE0\xC0\x3E\x0F\x83\xE0\xC0\x30\x0C\x03\x00\xC0\x3E\x0F\x83\xE0\xC0\x30\x0C\x03\xE0\xC0\x3E\x0F\x83\xE0\xC0\x30\x0F\x83\x00\xC0\x3E\x0F\x83\xE0\xC0\x30\x0F\x83\xE0\xC0\x3E\x0F\x83\xE0\xC0\x3E\x0C\x03\x00\xC0\x3E\x0F\x83\xE0\xC0\x3E\x0C\x03\xE0\xC0\x3E\x0F\x83\xE0\xC0\x3E\x0F\x83\x00\xC0\x3E\x0F\x83\xE0\xC0\x3E\x0F\x83\xE0\xC0\x3E\x0F\x83\xE0\xF8\x30\x0C\x03\x00\xC0\x3E\x0F\x83\xE0\xF8\x30\x0C\x03\xE0\xC0\x3E\x0F\x83\xE0\xF8\x30\x0F\x83\x00\xC0\x3E\x0F\x83\xE0\xF8\x30\x0F\x83\xE0\xC0\x3E\x0F\x83\xE0\xF8\x3E\x0C\x03\x00\xC0\x3E\x0F\x83\xE0\xF8\x3E\x0C\x03\xE0\xC0\x3E\x0F\x83\xE0\xF8\x3E\x0F\x83\x00\xC0\x3E\x0F\x83\xE0\xF8\x3E\x0F\x83\xE0\xF8\x30\x0C\x03\x00\xC0\x30\x0C\x03\x00\xF8\x30\x0C\x03\x00\xC0\x30\x0C\x03\xE0\xF8\x30\x0C\x03\x00\xC0\x30\x0F\x83\x00\xF8\x30\x0C\x03\x00\xC0\x30\x0F\x83\xE0\xF8\x30\x0C\x03\x00\xC0\x3E\x0C\x03\x00\xF8\x30\x0C\x03\x00\xC0\x3E\x0C\x03\xE0\xF8\x30\x0C\x03\x00\xC0\x3E\x0F\x83\x00\xF8\x30\x0C\x03\x00\xC0\x3E\x0F\x83\xE0\xF8\x30\x0C\x03\x00\xF8\x30\x0C\x03\x00\xF8\x30\x0C\x03\x00\xF8\x30\x0C\x03\xE0\xF8\x30\x0C\x03\x00\xF8\x30\x0F\x83\x00\xF8\x30\x0C\x03\x00\xF8\x30\x0F\x83\xE0\xF8\x30\x0C\x03\x00\xF8\x3E\x0C\x03\x00\xF8\x30\x0C\x03\x00\xF8\x3E\x0C\x03\xE0\xF8\x30\x0C\x03\x00\xF8\x3E\x0F\x83\x00\xF8\x30\x0C\x03\x00\xF8\x3E\x0F\x83\xE0\xF8\x30\x0C\x03\xE0\xC0\x30\x0C\x03\x00\xF8\x30\x0C\x03\xE0\xC0\x30\x0C\x03\xE0\xF8\x30\x0C\x03\xE0\xC0\x30\x0F\x83\x00\xF8\x30\x0C\x03\xE0\xC0\x30\x0F\x83\xE0\xF8\x30\x0C\x03\xE0\xC0\x3E\x0C\x03\x00\xF8\x30\x0C\x03\xE0\xC0\x3E\x0C\x03\xE0\xF8\x30\x0C\x03\xE0\xC0\x3E\x0F\x83\x00\xF8\x30\x0C\x03\xE0\xC0\x3E\x0F\x83\xE0\xF8\x30\x0C\x03\xE0\xF8\x30\x0C\x03\x00\xF8\x30\x0C\x03\xE0\xF8\x30\x0C\x03\xE0\xF8\x30\x0C\x03\xE0\xF8\x30\x0F\x83\x00\xF8\x30\x0C\x03\xE0\xF8\x30\x0F\x83\xE0\xF8\x30\x0C\x03\xE0\xF8\x3E\x0C\x03\x00\xF8\x30\x0C\x03\xE0\xF8\x3E\x0C\x03\xE0\xF8\x30\x0C\x03\xE0\xF8\x3E\x0F\x83\x00\xF8\x30\x0C\x03\xE0\xF8\x3E\x0F\x83\xE0\xF8\x30\x0F\x83\x00\xC0\x30\x0C\x03\x00\xF8\x30\x0F\x83\x00\xC0\x30\x0C\x03\xE0\xF8\x30\x0F\x83\x00\xC0\x30\x0F\x83\x00\xF8\x30\x0F\x83\x00\xC0\x30\x0F\x83\xE0\xF8\x30\x0F\x83\x00\xC0\x3E\x0C\x03\x00\xF8\x30\x0F\x83\x00\xC0\x3E\x0C\x03\xE0\xF8\x30\x0F\x83\x00\xC0\x3E\x0F\x83\x00\xF8\x30\x0F\x83\x00\xC0\x3E\x0F\x83\xE0\xF8\x30\x0F\x83\x00\xF8\x30\x0C\x03\x00\xF8\x30\x0F\x83\x00\xF8\x30\x0C\x03\xE0\xF8\x30\x0F\x83\x00\xF8\x30\x0F\x83\x00\xF8\x30\x0F\x83\x00\xF8\x30\x0F\x83\xE0\xF8\x30\x0F\x83\x00\xF8\x3E\x0C\x03\x00\xF8\x30\x0F\x83\x00\xF8\x3E\x0C\x03\xE0\xF8\x30\x0F\x83\x00\xF8\x3E\x0F\x83\x00\xF8\x30\x0F\x83\x00\xF8\x3E\x0F\x83\xE0\xF8\x30\x0F\x83\xE0\xC0\x30\x0C\x03\x00\xF8\x30\x0F\x83\xE0\xC0\x30\x0C\x03\xE0\xF8\x30\x0F\x83\xE0\xC0\x30\x0F\x83\x00\xF8\x30\x0F\x83\xE0\xC0\x30\x0F\x83\xE0\xF8\x30\x0F\x83\xE0\xC0\x3E\x0C\x03\x00\xF8\x30\x0F\x83\xE0\xC0\x3E\x0C\x03\xE0\xF8\x30\x0F\x83\xE0\xC0\x3E\x0F\x83\x00\xF8\x30\x0F\x83\xE0\xC0\x3E\x0F\x83\xE0\xF8\x30\x0F\x83\xE0\xF8\x30\x0C\x03\x00\xF8\x30\x0F\x83\xE0\xF8\x30\x0C\x03\xE0\xF8\x30\x0F\x83\xE0\xF8\x30\x0F\x83\x00\xF8\x30\x0F\x83\xE0\xF8\x30\x0F\x83\xE0\xF8\x30\x0F\x83\xE0\xF8\x3E\x0C\x03\x00\xF8\x30\x0F\x83\xE0\xF8\x3E\x0C\x03\xE0\xF8\x30\x0F\x83\xE0\xF8\x3E\x0F\x83\x00\xF8\x30\x0F\x83\xE0\xF8\x3E\x0F\x83\xE0\xF8\x3E\x0C\x03\x00\xC0\x30\x0C\x03\x00\xF8\x3E\x0C\x03\x00\xC0\x30\x0C\x03\xE0\xF8\x3E\x0C\x03\x00\xC0\x30\x0F\x83\x00\xF8\x3E\x0C\x03\x00\xC0\x30\x0F\x83\xE0\xF8\x3E\x0C\x03\x00\xC0\x3E\x0C\x03\x00\xF8\x3E\x0C\x03\x00\xC0\x3E\x0C\x03\xE0\xF8\x3E\x0C\x03\x00\xC0\x3E\x0F\x83\x00\xF8\x3E\x0C\x03\x00\xC0\x3E\x0F\x83\xE0\xF8\x3E\x0C\x03\x00\xF8\x30\x0C\x03\x00\xF8\x3E\x0C\x03\x00\xF8\x30\x0C\x03\xE0\xF8\x3E\x0C\x03\x00\xF8\x30\x0F\x83\x00\xF8\x3E\x0C\x03\x00\xF8\x30\x0F\x83\xE0\xF8\x3E\x0C\x03\x00\xF8\x3E\x0C\x03\x00\xF8\x3E\x0C\x03\x00\xF8\x3E\x0C\x03\xE0\xF8\x3E\x0C\x03\x00\xF8\x3E\x0F\x83\x00\xF8\x3E\x0C\x03\x00\xF8\x3E\x0F\x83\xE0\xF8\x3E\x0C\x03\xE0\xC0\x30\x0C\x03\x00\xF8\x3E\x0C\x03\xE0\xC0\x30\x0C\x03\xE0\xF8\x3E\x0C\x03\xE0\xC0\x30\x0F\x83\x00\xF8\x3E\x0C\x03\xE0\xC0\x30\x0F\x83\xE0\xF8\x3E\x0C\x03\xE0\xC0\x3E\x0C\x03\x00\xF8\x3E\x0C\x03\xE0\xC0\x3E\x0C\x03\xE0\xF8\x3E\x0C\x03\xE0\xC0\x3E\x0F\x83\x00\xF8\x3E\x0C\x03\xE0\xC0\x3E\x0F\x83\xE0\xF8\x3E\x0C\x03\xE0\xF8\x30\x0C\x03\x00\xF8\x3E\x0C\x03\xE0\xF8\x30\x0C\x03\xE0\xF8\x3E\x0C\x03\xE0\xF8\x30\x0F\x83\x00\xF8\x3E\x0C\x03\xE0\xF8\x30\x0F\x83\xE0\xF8\x3E\x0C\x03\xE0\xF8\x3E\x0C\x03\x00\xF8\x3E\x0C\x03\xE0\xF8\x3E\x0C\x03\xE0\xF8\x3E\x0C\x03\xE0\xF8\x3E\x0F\x83\x00\xF8\x3E\x0C\x03\xE0\xF8\x3E\x0F\x83\xE0\xF8\x3E\x0F\x83\x00\xC0\x30\x0C\x03\x00\xF8\x3E\x0F\x83\x00\xC0\x30\x0C\x03\xE0\xF8\x3E\x0F\x83\x00\xC0\x30\x0F\x83\x00\xF8\x3E\x0F\x83\x00\xC0\x30\x0F\x83\xE0\xF8\x3E\x0F\x83\x00\xC0\x3E\x0C\x03\x00\xF8\x3E\x0F\x83\x00\xC0\x3E\x0C\x03\xE0\xF8\x3E\x0F\x83\x00\xC0\x3E\x0F\x83\x00\xF8\x3E\x0F\x83\x00\xC0\x3E\x0F\x83\xE0\xF8\x3E\x0F\x83\x00\xF8\x30\x0C\x03\x00\xF8\x3E\x0F\x83\x00\xF8\x30\x0C\x03\xE0\xF8\x3E\x0F\x83\x00\xF8\x30\x0F\x83\x00\xF8\x3E\x0F\x83\x00\xF8\x30\x0F\x83\xE0\xF8\x3E\x0F\x83\x00\xF8\x3E\x0C\x03\x00\xF8\x3E\x0F\x83\x00\xF8\x3E\x0C\x03\xE0\xF8\x3E\x0F\x83\x00\xF8\x3E\x0F\x83\x00\xF8\x3E\x0F\x83\x00\xF8\x3E\x0F\x83\xE0\xF8\x3E\x0F\x83\xE0\xC0\x30\x0C\x03\x00\xF8\x3E\x0F\x83\xE0\xC0\x30\x0C\x03\xE0\xF8\x3E\x0F\x83\xE0\xC0\x30\x0F\x83\x00\xF8\x3E\x0F\x83\xE0\xC0\x30\x0F\x83\xE0\xF8\x3E\x0F\x83\xE0\xC0\x3E\x0C\x03\x00\xF8\x3E\x0F\x83\xE0\xC0\x3E\x0C\x03\xE0\xF8\x3E\x0F\x83\xE0\xC0\x3E\x0F\x83\x00\xF8\x3E\x0F\x83\xE0\xC0\x3E\x0F\x83\xE0\xF8\x3E\x0F\x83\xE0\xF8\x30\x0C\x03\x00\xF8\x3E\x0F\x83\xE0\xF8\x30\x0C\x03\xE0\xF8\x3E\x0F\x83\xE0\xF8\x30\x0F\x83\x00\xF8\x3E\x0F\x83\xE0\xF8\x30\x0F\x83\xE0\xF8\x3E\x0F\x83\xE0\xF8\x3E\x0C\x03\x00\xF8\x3E\x0F\x83\xE0\xF8\x3E\x0C\x03\xE0\xF8\x3E\x0F\x83\xE0\xF8\x3E\x0F\x83\x00\xF8\x3E\x0F\x83\xE0\xF8\x3E\x0F\x83\xE0";

class neoPixels {
    spi = null;
    frameSize = null;
    frame = null;

    // _spi - A configured spi (MSB_FIRST, 7.5MHz)
    // _frameSize - Number of Pixels per frame
    constructor(_spi, _frameSize) {
        this.spi = _spi;
        this.frameSize = _frameSize;
        this.frame = blob(frameSize*30 + 20);
        
        clearFrame();
        writeFrame();
    }

    function writePixel(p,r,g,b) {
        frame.seek(p*30);
        local i = 0;
        
        // release 26:
        for (i = 0 ; i < 10; i++) frame.writen(bits[g*10 + i],'c');
        for (i = 0 ; i < 10; i++) frame.writen(bits[r*10 + i],'c');
        for (i = 0 ; i < 10; i++) frame.writen(bits[b*10 + i],'c');
        //frame.writestring(bits[g]);
        //frame.writestring(bits[r]);
        //frame.writestring(bits[b]);
    }
    
    function clearFrame() {
      for (local p = 0; p < frameSize; p++) writePixel(p,0,0,0);
      for (local i = 0; i < 40; i++) frame.writen(0x00,'c');
    }
    
    function writeFrame() {
        spi.write(frame);
    }
}

const NUMPIXELS = 30;
const DELAY = 0.025;

spi <- hardware.spi257;
spi.configure(MSB_FIRST, 7500);
pixelStrip <- neoPixels(spi, NUMPIXELS);

pixels <- [0,0,0,0,0]
currentPixel <- 0;
pAdd <- 1;

function test(d = null) { 
  pixelStrip.writePixel(pixels[0], 0, 0, 0);
  for(local i = 1; i < 5; i++) {
      local b = math.pow(2, i);
      pixelStrip.writePixel(pixels[i], b, b / 2, b * 1.5);
  }
  
  pixelStrip.writeFrame();
  if (currentPixel >= NUMPIXELS-1) pAdd = -1;
  if (currentPixel <= 0) pAdd = 1;
  currentPixel += pAdd;
  
  for (locacl i = 0; i < 4; i++) pixels[i] = pixels[i+1];
  pixels[4] = currentPixel;
  
  imp.wakeup(DELAY, test);
} test();